@page "/"
@using sk.shared
@using sk.weblib
@using sk.weblib.Modals
@inject NavigationManager NavigationManager
@inject IJSRuntime JSRuntime

<PageTitle>pax.schafkopf</PageTitle>

<TableComponent Player="player" GameGuid="tableGuid" OnGuidSet="SetGuid" />

<ConnectModal @ref="connectModal" OnConnect="Connect" />

@code {
    [SupplyParameterFromQuery]
    public string? TableGuid { get; set; }

    Player player = new() { Guid = Guid.NewGuid(), Name = "TestUser" };
    Guid tableGuid = Guid.Empty;

    ConnectModal? connectModal;

    protected override void OnInitialized()
    {
        if (Guid.TryParse(TableGuid, out var guid))
        {
            tableGuid = guid;
        }
        base.OnInitialized();
    }

    private void Connect(Guid guid)
    {

    }

    private void SetGuid(Guid guid)
    {
        TableGuid = guid.ToString();
        Dictionary<string, object?> queryDic = [];
        queryDic.Add("TableGuid", guid.ToString());
        var url = NavigationManager.GetUriWithQueryParameters(queryDic);
        JSRuntime.InvokeVoidAsync("updateUrlSilently", url);
    }
}